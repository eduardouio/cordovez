{% set valFob  = 0.0 %}
{% set valInformativasDolar  = 0.0 %}
{% set valInformativasEuro  = 0.0 %}
{% set valorderInvoicesDolar  = 0.0 %}
{% set valorderInvoicesEuro  = 0.0 %}
{% set parcials = 0 %}
{% set valParcials  = 0.0 %}
{% for invoice in  invoicesOrder %}
{% if invoice.tipo_cambio == 1 %}
   {% set valorderInvoicesDolar = valorderInvoicesDolar + (invoice.valor)%}
{% else %}
   {% set valorderInvoicesEuro = valorderInvoicesEuro + (invoice.valor) %}   
{% endif %}
{%  set valFob = valFob + (
invoice.detailInvoice.sums.valueItems * invoice.detailInvoice.sums.tasa_change) %}
{% endfor %}
{% for infoInvoice in infoInvoices  %}
{% set parcials = parcials + 1 %}
{% if infoInvoice.tipo_cambio == 1 %}
   {% set valInformativasDolar = valInformativasDolar + (infoInvoice.valor)%}
{% else %}
   {% set valInformativasEuro = valInformativasEuro + (infoInvoice.valor) %}   
{% endif %}
{% set valParcials = valParcials +  (infoInvoice.valor * infoInvoice.tipo_cambio) %}
{% endfor %}
<div class="well well-sm">
   <div class="row">
      <div class="col-sm-3">
         <strong>Total Valor FOB:</strong>
         <span class="fa fa-usd"></span>
         <strong class="text-primary">
         {{(valFob) | number_format(2, '.', ',') }}
         </strong>  
      </div>
      <div class="col-sm-2">
         <strong>Parciales Anteriores:</strong>
         <span class="text-primary">
         <strong>{{ parcials }}</strong>
      </div>
      <div class="col-sm-2">
         <strong>
         Nro Pedido:</strong> 
         <span class="text-primary">
         {{ order.nro_pedido }}
         </span>
      </div>
      <div class="col-sm-2">
         <strong>
         Regimen:</strong> 
         <span class="text-primary">
         <strong class="text-primary">
         {{ order.regimen  }}
         </strong>   
         </span>
      </div>
      <div class="col-sm-3">
         <strong>
         Fecha Registro:</strong> 
         <span class="text-primary">
         {{ order.date_create }}            
         </span>
      </div>
   </div>
   <div class="row">
      <div class="col-sm-3">
         <strong>Tiempo Bodega:</strong>
         <span class="text-primary">
         {{ warehouseDays.years }} años /
         {{ warehouseDays.mounts }} meses /
         {{ warehouseDays.days }} días
         </span>
      </div>
      <div class="col-sm-2">
         <strong>P. Origen:</strong> 
         <span class="text-primary">
         {{ order.pais_origen }}
         </span>
      </div>
      <div class="col-sm-2">
         <strong>C Origen:</strong> 
         <span class="text-primary">
         {{ order.ciudad_origen  }}            
         </span>
      </div>
      <div class="col-sm-2">
         <strong>Incoterm:</strong> 
         <span class="text-primary">
         {{order.incoterm}}
         </span>         
      </div>
      <div class="col-sm-2">
         <strong>Creado Por:</strong> 
         <span>{{user['nombres']}}
         </span>
      </div>
   </div>
</div>
<br>
<div class="row">
   <div class="col-sm-3">
      &nbsp;
   </div>
   <div class="col-sm-3">
      <h4 class="text-primary">
         <small>Saldo en $:</small>
         <span id="saldo_dolares">
            {{ (valorderInvoicesDolar - valInformativasDolar) | number_format(2, '.', ',') }}
         </span>
      </h4>
   </div>
   <div class="col-sm-3">
      <h4 class="text-primary">
         <small>Saldo En &euro;:</small>
         <span id="saldo_euros"> 
            {{ (valorderInvoicesEuro - valInformativasEuro) | number_format(2, '.', ',')}}
         </span>
      </h4>
   </div>
   <div class="col-sm-3">
      <a href="{{rute_url}}pedido/presentar/{{order.nro_pedido}}" class="btn btn-sm btn-warning">
         <span class="fa fa-arrow-left fa-fw"></span>
         Cancelar y Volver Pedido<b>[{{order.nro_pedido}}]</b>
         </a>
   </div>
</div>
<br>
<form method="post" action="{{rute_url}}facinformativa/validar/">
   <div class="row">
      <div class="col-md-1">
         <div class="form-group">
            <label>Pedido</label>
            <input 
               readonly="" 
               type="text" 
               name="nro_pedido"
               class="form-control" 
               value="{{order.nro_pedido}}" 
               >
         </div>
      </div>
      <div class="col-md-3">
         <div class="form-group">
            <label>Proveedor</label>
            <select
               name="identificacion_proveedor"
               class="form-control"
               required = "required"
               >
               <option value="{{supplier.identificacion_proveedor}}"> {{supplier.nombre}} </option>
            </select>
         </div>
      </div>
      <div class="col-md-2">
         <div class="form-group">
            <label>Nro Factura Informativa</label>
            <input 
               type="text" 
               name="nro_factura_informativa"
               class="form-control" 
               autofocus="autofocus" 
               required="required" 
               >
         </div>
      </div>
      <div class="col-md-2">
         <div class="form-group">
            <label>Fecha Emisión</label>
            <div class="input-group date" data-provide="datepicker">
               <input 
                  type="text" 
                  class="form-control" 
                  id="fecha_emision" 
                  required="required" 
                  name="fecha_emision" 
                  class="bootstrap-datepicker" 
                  >
               <div class="input-group-addon">
                  <span class="glyphicon glyphicon-th"></span>
               </div>
            </div>
         </div>
      </div>
      <div class="col-md-2">
         <div class="form-group">
            <label>Seguro Aduana <small><b>USD</b></small>
            </label>
            <input 
               type="number" 
               name="seguro_aduana"
               class="form-control" 
               step="0.01" 
               required="required" 
               >
         </div>
      </div>
      <div class="col-md-2">
         <div class="form-group">
            <label>Felte Aduana <small><b>USD</b></small>
            </label>
            <input 
               type="number" 
               name="flete_aduana"
               class="form-control" 
               step="0.01" 
               required="required" 
               >
         </div>
      </div>
   </div>
   <div class="row">
      <div class="col-md-2">
         <div class="form-group">
            <label>Nro Referendo</label>
            <input 
               type="text" 
               name = "nro_refrendo"
               placeholder="000-0000-00-000000"
               class="form-control" 
               maxlength="20" 
               >
         </div>
      </div>
      <div class="col-md-2">
         <div class="form-group">
            <label>Valor</label>
            <input 
               class="form-control" 
               type="number" 
               name="valor"
               id="valor"
               step="0.01" 
               required="required" 
               >
         </div>
      </div>
      {% if haveEuros.euros == true %}
      <div class="col-md-2">
         <div class="form-group">
            <label>Moneda</label>
            <select
               name="moneda"
               id="moneda"
               required = "required"
               class="form-control"
               >
               <option value="EUROS">EUROS</option>
               <option value="DOLARES">DOLARES</option>
            </select>
         </div>
      </div>
      <div class="col-md-2">
         <div class="form-group">
            <label>Tipo De Cambio</label>
            <input 
               class="form-control" 
               type="number"
               step="0.000000000001"
               name="tipo_cambio"
               id="tipo_cambio"
               value="{{haveEuros.tipo_cambio}}" 
               required="required" 
               >
         </div>
      </div>
      <div class="col-md-2">
         <div class="form-group">
            <label>Total USD</label>
            <input 
               disabled=""   
               class="form-control"   
               id="total" 
               value="0" 
               style="font-weight: bold; font-size: 14px; color:blue" 
               >
         </div>
      </div>
      {% else %}
      <input type="hidden" name="moneda" value="DOLARES">
      <input type="hidden" name="tipo_cambio" value="1">
      {% endif %}
      <div class="col-md-2">
         <div class="form-group">
            <label>Comentarios</label>
            <textarea name="comentarios" class="form-control" rows="3" id="comentarios"></textarea>
         </div>
      </div>
   </div>
   <div class="row">
      <div class="col-md-12">
         <hr>
         <button type="submit" class="btn btn-sm btn-default" >
         <span class="fa fa-save fa-fw"></span>
         Guardar Registro
         </button>
         <a href="{{rute_url}}pedido/presentar/{{order.nro_pedido}}" class="btn btn-sm btn-default">
         <span class="fa fa-arrow-left fa-fw"></span>
         Volver al Pedido <b>[{{order.nro_pedido}}]</b>
         </a>
      </div>
   </div>
</form>
<script type="text/javascript">   
   $('#moneda').change(function(){
     if($(this).val() === 'EUROS'){
       $('#tipo_cambio').removeAttr('readonly');
     }else{
       $('#tipo_cambio').attr('readonly', true);
       $('#tipo_cambio').val(1);
     }
     $('#total').val($('#valor').val() * $('#tipo_cambio').val());  
   });
   
   $('#valor').keyup(function(){
     $('#total').val($('#valor').val() * $('#tipo_cambio').val());  
   })

   $('#tipo_cambio').keyup(function(){
     $('#total').val($('#valor').val() * $('#tipo_cambio').val());   
   });

   //tranformamos a mayusculas los comentarios
   $('#comentarios').keyup(function() {
   this.value = this.value.toUpperCase();
});
</script>

