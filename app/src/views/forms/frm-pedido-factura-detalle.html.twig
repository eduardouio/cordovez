
<form method="post" action="{{rute_url}}detallepedido/validar">
   <input type="hidden" name="id_pedido_factura" value="{{invoice.id_pedido_factura}}">
   <div class="row">
      <div class="col-md-6">
         <div class="form-group">
            <label>Producto &nbsp;&nbsp; <a href="{{ rute_url }}producto/nuevo"> <span class="fa fa-plus"></span>Nuevo Producto</a></label>
            <select 
            class="form-control" 
            name="cod_contable" 
            id="cod_contable" 
            required="true" 
            >  
               <option selected="" disabled="">Seleccione ... </option>
               {% for product in products %}
               <option value="{{product.cod_contable}}"> {{ product.nombre }}</option>
               {% endfor %}
            </select>
         </div>
      </div>
            <div class="col-md-1">
         <label>Cajas</label>
         <input 
         type="number" 
         class="form-control" 
         name="nro_cajas"
         id="nro_cajas"
         required="true" 
         step="1" 
         >
      </div>
      <div class="col-md-1">
         <label>Modificar</label>
         <input 
         type="checkbox" 
         class="form-control"
         id="chage_params" 
         >
      </div>
      <div class="col-md-2">
         <div class="form-group">
            <label>Grado Alcoholico</label>
            <input 
            class="form-control" 
            type="number" 
            step="0.01" 
            name="grado_alcoholico"
            required="true" 
            id="grado_alcoholico" 
            maxlength="4" 
            readonly="true" 
            >
         </div>
      </div>


      <div class="col-md-2">
         <label>Costo Caja</label>
         <input 
         type="number" 
         class="form-control" 
         name="costo_caja"
         id="costo_caja"
         required="true" 
         step="0.0000000001"
         readonly="true" 
         >

   </div>
</div>   
<div class="row">
	<div class="col-md-2">
	<div class="input-group">
		<label>Cantidad Caja</label>
		<input type="text" disabled="" id="cantidad_caja" class="form-control">
	</div>
</div>
<div class="col-md-2">
	<div class="input-group">
		<label>Unidades</label>
		<input type="text" disabled="" id="unidades" class="form-control">
	</div>
</div>
<div class="col-md-2">
	<div class="input-group">
		<label>Capacidad ML</label>
		<input type="text" disabled="" id="capacidad_ml" class="form-control">
	</div>
</div>
<div class="col-md-2">
	<div class="input-group">
		<label>Costo Und</label>
		<input type="text" disabled="" id="costo_und" class="form-control">
	</div>
</div>
<div class="col-md-2">
	<div class="form-group">
		<label class="text-danger">Costo Total</label>
		<input type="text" id="costoTotal" class="form-control" style="color:#a94442;font-weight: bold;" disabled="">
	</div>
</div>
<div class="col-md-2">&nbsp;</div>
</div>
   <div class="row">
      <div class="col-md-12">
         <hr>
         <button type="submit" class="btn btn-sm btn-default" >
            <span class="fa fa-save fa-fw"></span>
            Guardar Producto
         </button>
      <a href="{{rute_url}}pedidofactura/presentar/{{invoice.id_pedido_factura}}" class="btn btn-sm btn-default">
            <span class="fa fa-arrow-left fa-fw"></span>
            Regresar Factura
         </a>
      </div>
   </div>
</form>

<script type="text/javascript">
var maxValueInvoice = {{invoice.valor}};
</script>

<script type="text/javascript">
   var products = {{ productsarray | raw }};

   $('#cod_contable').change(function(){
   		$('#nro_cajas').val('');
      var e = $(this).val();
      $.each(products, function(key, value){
         if(e === value.cod_contable){
            $('#grado_alcoholico').val('');
            $('#costo_caja').val('');
            $('#costo_und').val('');
            $('#cantidad_caja').val('');
            $('#unidades').val('');
            $('#capacidad_ml').val('');
            $('#grado_alcoholico').val(value.grado_alcoholico);
            $('#costo_caja').val(value.costo_caja);
            $('#costo_und').val(Math.round((value.costo_caja/value.cantidad_x_caja) * 100)/100);
            $('#cantidad_caja').val(value.cantidad_x_caja);
            $('#capacidad_ml').val(value.capacidad_ml);
         }
      });      
   });

	$('#nro_cajas').change(function(){
		var numBoxes = parseFloat(this.value);
		var itemPerBox = parseFloat($('#cantidad_caja').val());
		var valBox = parseFloat($('#costo_caja').val());
      var costosTotalItems = parseFloat(numBoxes * valBox);
      costosTotalItems = Math.round(costosTotalItems * 1000)/1000;
		$('#unidades').val(numBoxes * itemPerBox);
		$('#costoTotal').val(costosTotalItems);
		if(costosTotalItems > maxValueInvoice ){
			alert('La cantidad de cajas excede el valor de la factura!');
			$('#nro_cajas').val(0);
			$('#costoTotal').val(0);
			$('#unidades').val(0);
		}
	});

$('#costo_caja').change(function(){
		var numBoxes = parseInt($('#nro_cajas').val());
		var itemPerBox = parseFloat($('#cantidad_caja').val());
		var valBox = parseFloat(this.value);
      var costosTotalItems = parseFloat(numBoxes * valBox);
      costosTotalItems = Math.round(costosTotalItems * 1000)/1000;
		$('#unidades').val(numBoxes * itemPerBox);
		$('#costoTotal').val(costosTotalItems);

		if(costosTotalItems > maxValueInvoice ){
			alert('La cantidad de cajas excede el valor de la factura!');
			$('#nro_cajas').val(0);
			$('#costo_caja').val(0);
			$('#costoTotal').val(0);
			$('#unidades').val(0);
		}
});

   $('#chage_params').click(function(){
      if( $('#chage_params').is(':checked') ){
         $('#grado_alcoholico').removeAttr('readonly');
         $('#costo_caja').removeAttr('readonly');
         $('#grado_alcoholico').focus();
      }else{
         $('#grado_alcoholico').attr('readonly', true);
         $('#costo_caja').attr('readonly', true);
      }
   });
</script>
